**The code has been updated to simplify usage.**

# Spatial Transformation Framework for Random Forest
The deep learning version is at: [Deep-learning-models](/Deep-learning-models): Fully-connected, convolutional, recurrent, ...

## Paper information
**[RSE'25]** Yiqun Xie, Anh Nhu, Xiao-Peng Song, Xiaowei Jia, Sergii Skakun, Haijun Li, Zhihao Wang. [Accounting for Spatial Variability with Geo-aware Random Forest: A Case Study for US Major Crop Mapping](https://www.sciencedirect.com/science/article/abs/pii/S0034425724006114). Remote Sensing of Environment, 2024.

## Major updates:
- Added new class GeoRF in GeoRF.py with standard functions: fit, predict, and evaluate to simplify usage.
- Added a new and simple demo code GeoRF_main.py to illustrate the usage and key steps (replacing STAR_main.py before).
- Added a GroupGenerator class in customize.py to highlight the key step of group generation and provide a simple example where groups are generated by grid cells.
- Added additional documentation.

## Comparing to Random Forest:
- As a spatially-explicit model (geo-aware version of RF), GeoRF requires an additional input X_loc that stores locations of data points in (X,y).
- GeoRF needs a group assignment (minimum spatial units) as demonstrated in the code and visualizations in the paper. The group definitions can be customized in customize.py based on data, applications and tasks.

## Sample demo data
- Features X ([X_demo.npy](https://drive.google.com/file/d/1sLM2Los_OHiJho2byLBMYLqkW_LEFtA5/view?usp=drive_link))
- Labels y ([y_demo.npy](https://drive.google.com/file/d/1CvX9n6mIM4jmFpSbfagjCvFhx3eok-fT/view?usp=drive_link))
- Locations X_loc ([X_loc_demo.npy](https://drive.google.com/file/d/1etm32pt1dbvdFaLF9pFZesak12AE-4X2/view?usp=drive_link))

## Example usage:
For details, please refer to [GeoRF_main.py](GeoRF_main.py)

Create new GeoRF model.
```
georf = GeoRF()#with optional parameters
```
Define groups of data points (minimum spatial units in partitioning).
```
group_gen = GroupGenerator(xmin, xmax, ymin, ymax, cell_size)#example using grid cells to define groups
X_group = group_gen.get_groups(X_loc)#convert locations to group IDs
```
Train GeoRF.
```
georf.fit(X, y, X_group)
```
Make predictions.
```
georf.predict(X_test)
```
Evaluate model.
```
georf.evaluate(X_test, y_test, X_test_group)#X_test_group is generated in the same way as training
```

It is recommended to run the model on multi-core machines to maximize the efficiency for random forest models. There is a parameter setting in paras.py that allows customized number of cores.
